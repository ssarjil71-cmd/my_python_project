<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard - Orders - HotelEase</title>
    <link rel="stylesheet" href="../static/manager_dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .orders-filter { background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .filter-group { display: flex; gap: 1rem; align-items: center; }
        .filter-select { padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; }
        .new-order { background: #fef3c7 !important; }
        .new-badge { background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; }
        .table-badge { background: #667eea; color: white; padding: 0.3rem 0.6rem; border-radius: 6px; font-size: 0.8rem; font-weight: 600; }
        .status-new { background: #fef3c7; color: #92400e; }
        .status-preparing { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .qr-link { color: #667eea; text-decoration: none; font-weight: 600; }
        .qr-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="logo">
                <i class="fas fa-hotel"></i>
                HotelEase
            </div>
        </div>
        <div class="nav-right">
            <div class="profile-dropdown">
                <div class="profile-btn" onclick="toggleProfile()">
                    <img src="https://via.placeholder.com/40x40/667eea/ffffff?text=M" alt="Profile" class="profile-img">
                    <span class="profile-name">Manager</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="profile-menu" id="profileMenu">
                    <a href="#"><i class="fas fa-user"></i> Profile Settings</a>
                    <a href="#"><i class="fas fa-cog"></i> Account Settings</a>
                    <a href="/"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <a href="../templates/manager_dashboard.html" class="menu-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item active">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Orders</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-users"></i>
                    <span>Waiters</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-utensils"></i>
                    <span>Menu</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Verification</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1>Orders</h1>
                <p>Manage all restaurant orders including QR-based table orders</p>
            </div>

            <!-- Quick Actions -->
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                <a href="tables_qr.html" class="btn-primary" style="text-decoration: none;">
                    <i class="fas fa-qrcode"></i> Manage Table QR Codes
                </a>
                <button onclick="refreshOrders()" class="btn-primary" style="background: #10b981;">
                    <i class="fas fa-sync-alt"></i> Refresh Orders
                </button>
            </div>

            <!-- Orders Filter -->
            <div class="orders-filter">
                <div class="filter-group">
                    <label>Filter by Table:</label>
                    <select class="filter-select" id="tableFilter" onchange="filterOrders()">
                        <option value="all">All Tables</option>
                        <option value="1">Table 1</option>
                        <option value="2">Table 2</option>
                        <option value="3">Table 3</option>
                        <option value="4">Table 4</option>
                        <option value="5">Table 5</option>
                        <option value="6">Table 6</option>
                    </select>
                    
                    <label style="margin-left: 2rem;">Filter by Status:</label>
                    <select class="filter-select" id="statusFilter" onchange="filterOrders()">
                        <option value="all">All Status</option>
                        <option value="new">New</option>
                        <option value="preparing">Preparing</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="table-card">
                <h3><i class="fas fa-list-alt"></i> QR Code Orders</h3>
                <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                    <thead>
                        <tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Order ID</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Table</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Items</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Quantity</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Total</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Status</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Time</th>
                            <th style="padding: 1rem; text-align: left; font-weight: 600; color: #4a5568;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table-body">
                        <!-- Orders will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        let allOrders = [];

        // Sample orders data
        function initializeOrders() {
            allOrders = [
                {
                    id: 'QR-001',
                    table: 1,
                    items: 'Chicken Curry, Rice, Naan',
                    quantity: 3,
                    total: 24.50,
                    status: 'new',
                    time: '2 mins ago',
                    isNew: true
                },
                {
                    id: 'QR-002',
                    table: 3,
                    items: 'Pizza Margherita, Coke',
                    quantity: 2,
                    total: 18.75,
                    status: 'preparing',
                    time: '8 mins ago',
                    isNew: false
                },
                {
                    id: 'QR-003',
                    table: 2,
                    items: 'Burger, Fries, Milkshake',
                    quantity: 3,
                    total: 22.25,
                    status: 'new',
                    time: '5 mins ago',
                    isNew: true
                },
                {
                    id: 'QR-004',
                    table: 5,
                    items: 'Caesar Salad, Grilled Chicken',
                    quantity: 2,
                    total: 27.00,
                    status: 'completed',
                    time: '15 mins ago',
                    isNew: false
                }
            ];

            // Check for new orders from localStorage
            const newOrder = localStorage.getItem('newQROrder');
            if (newOrder) {
                const orderData = JSON.parse(newOrder);
                allOrders.unshift({
                    id: `QR-${String(allOrders.length + 1).padStart(3, '0')}`,
                    table: parseInt(orderData.tableNumber),
                    items: orderData.items.map(item => `${item.name} (x${item.quantity})`).join(', '),
                    quantity: orderData.items.reduce((sum, item) => sum + item.quantity, 0),
                    total: orderData.total,
                    status: 'new',
                    time: 'Just now',
                    isNew: true
                });
                localStorage.removeItem('newQROrder');
            }

            renderOrders(allOrders);
        }

        function renderOrders(orders) {
            const tableBody = document.getElementById('orders-table-body');
            tableBody.innerHTML = '';

            orders.forEach(order => {
                const row = document.createElement('tr');
                row.className = order.isNew ? 'new-order' : '';
                row.style.borderBottom = '1px solid #f1f5f9';
                row.onmouseover = () => row.style.background = '#f8fafc';
                row.onmouseout = () => row.style.background = order.isNew ? '#fef3c7' : 'white';

                row.innerHTML = `
                    <td style="padding: 1rem; font-weight: 600; color: #2d3748;">
                        ${order.id}
                        ${order.isNew ? '<span class="new-badge">NEW</span>' : ''}
                    </td>
                    <td style="padding: 1rem;">
                        <span class="table-badge">Table ${order.table}</span>
                    </td>
                    <td style="padding: 1rem;">${order.items}</td>
                    <td style="padding: 1rem; text-align: center;">${order.quantity}</td>
                    <td style="padding: 1rem; font-weight: 600;">$${order.total.toFixed(2)}</td>
                    <td style="padding: 1rem;">
                        <span style="padding: 0.4rem 0.8rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;" class="status-${order.status}">
                            ${order.status}
                        </span>
                    </td>
                    <td style="padding: 1rem; color: #718096;">${order.time}</td>
                    <td style="padding: 1rem;">
                        ${order.status === 'new' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'preparing')" style="background: #3b82f6; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-right: 0.5rem;">
                                Start
                            </button>
                        ` : ''}
                        ${order.status === 'preparing' ? `
                            <button onclick="updateOrderStatus('${order.id}', 'completed')" style="background: #10b981; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                Complete
                            </button>
                        ` : ''}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function filterOrders() {
            const tableFilter = document.getElementById('tableFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            let filteredOrders = allOrders;

            if (tableFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.table.toString() === tableFilter);
            }

            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }

            renderOrders(filteredOrders);
        }

        function updateOrderStatus(orderId, newStatus) {
            const order = allOrders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                order.isNew = false;
                renderOrders(allOrders);
            }
        }

        function refreshOrders() {
            initializeOrders();
        }

        function toggleProfile() {
            const menu = document.getElementById('profileMenu');
            menu.classList.toggle('show');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeOrders);
    </script>
</body>
</html>