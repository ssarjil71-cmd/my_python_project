<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='guest_verification/dashboard.css') }}">
</head>
<body>
    <div class="container">
        <header class="dashboard-header">
            <h1>Guest Verification Dashboard</h1>
            <div class="header-actions">
                <button onclick="refreshData()" class="refresh-btn">Refresh</button>
                <a href="{{ url_for('hotel_manager.dashboard') }}" class="back-btn">Back to Dashboard</a>
            </div>
        </header>

        <div class="qr-section">
            <div class="qr-card">
                <h3>Public Verification Form</h3>
                <div class="qr-container">
                    <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" class="qr-image">
                </div>
                <div class="qr-actions">
                    <input type="text" value="{{ public_url }}" readonly class="url-input">
                    <button onclick="copyUrl()" class="copy-btn">Copy URL</button>
                    <a href="{{ url_for('guest_verification.download_qr', manager_id=manager_id) }}" 
                       class="download-btn">Download QR</a>
                </div>
            </div>
        </div>

        <div class="verifications-section">
            <h2>Verification Requests</h2>
            <div class="filter-controls">
                <select id="statusFilter" onchange="filterVerifications()">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>

            <div class="verifications-grid" id="verificationsGrid">
                {% for verification in verifications %}
                <div class="verification-card" data-status="{{ verification[7] }}">
                    <div class="card-header">
                        <h4>{{ verification[1] }}</h4>
                        <span class="status-badge status-{{ verification[7] }}">{{ verification[7].title() }}</span>
                    </div>
                    <div class="card-body">
                        <p><strong>Phone:</strong> {{ verification[2] }}</p>
                        <p><strong>Address:</strong> {{ verification[3] }}</p>
                        <p><strong>KYC:</strong> {{ verification[4] }}</p>
                        <p><strong>Submitted:</strong> {{ verification[6].strftime('%Y-%m-%d %H:%M') if verification[6] else 'N/A' }}</p>
                        {% if verification[5] %}
                        <p><strong>Document:</strong> 
                            <a href="{{ url_for('static', filename=verification[5]) }}" target="_blank">View Document</a>
                        </p>
                        {% endif %}
                    </div>
                    <div class="card-actions">
                        {% if verification[7] == 'pending' %}
                        <button onclick="updateStatus({{ verification[0] }}, 'approved')" class="approve-btn">Approve</button>
                        <button onclick="updateStatus({{ verification[0] }}, 'rejected')" class="reject-btn">Reject</button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if not verifications %}
            <div class="no-data">
                <p>No verification requests yet.</p>
                <p>Share the QR code or URL above with guests to start receiving verifications.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='guest_verification/dashboard.js') }}"></script>
    <script>
        const managerId = {{ manager_id }};
    </script>
</body>
</html>